# 性能优化

- 用户体验
  - loading可以大大缓解等待时候的无聊和焦虑，有效让用户明确知道目前Loading的状态，并对结果有一个直观的预期
- 网络方面
  - 减少HTTP请求个数（缓存等）
  - 图片优化（雪碧图，图片压缩，图片懒加载）
  - CDN
- 页面渲染（减少回流和重绘）
  - 不用js操作样式，而是切换class
  - 元素离线更新（document.fragment对元素进行一次性的操作，再添加到页面中）
  - 各种标签的位置
- js阻塞方面
  - defer和async防止js对dom解析的阻塞
  - 首屏的js放底部

### 插入几万个 DOM，如何实现页面不卡顿？

肯定不能一次性把几万个 DOM 全部插入，这样肯定会造成卡顿，所以解决问题的重点应该是如何分批次部分渲染 DOM。

- `requestAnimationFrame` 的方式去**循环插入** DOM
- **虚拟滚动**（`virtualized scroller`）。

这种技术的原理就是**只渲染可视区域内的内容，非可见区域的那就完全不渲染了，当用户在滚动的时候就实时去替换渲染的内容。**

[![滚动](https://github.com/zyg1999/Note/raw/master/review/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/pic/vScroll.png)](https://github.com/zyg1999/Note/blob/master/review/性能优化/pic/vScroll.png)

从上图中我们可以发现，即使列表很长，但是渲染的 DOM 元素永远只有那么几个，当我们滚动页面的时候就会实时去更新 DOM，这个技术就能顺利解决这发问题。如果你想了解更多的内容可以了解下这个 [react-virtualized](https://github.com/bvaughn/react-virtualized)。