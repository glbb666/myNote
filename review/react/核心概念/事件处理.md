### ![reactåˆæˆäº‹ä»¶](images/reactäº‹ä»¶æœºåˆ¶.png)

### reactåˆæˆäº‹ä»¶æ˜¯ä»€ä¹ˆ

åœ¨`document`ä¸Šæ³¨å†Œäº†ä¸€ä¸ªåˆæˆäº‹ä»¶å±‚ï¼Œä»£ç†äº†ç»„ä»¶æ ‘ä¸Šçš„æ‰€æœ‰äº‹ä»¶ï¼Œå®ƒç›‘å¬çš„æ˜¯`document`çš„å†’æ³¡é˜¶æ®µã€‚

### Reactä¸ºä»€ä¹ˆè¦ä½¿ç”¨åˆæˆäº‹ä»¶

ç®€å•é«˜æ•ˆã€‚æŠŠæ‰€æœ‰äº‹ä»¶ç»‘å®šåˆ°ç»“æ„çš„æœ€å¤–å±‚ï¼Œä½¿ç”¨ä¸€ä¸ªç»Ÿä¸€çš„äº‹ä»¶ç›‘å¬å™¨ï¼Œè¿™ä¸ªäº‹ä»¶ç›‘å¬å™¨ä¸Šç»´æŒäº†ä¸€ä¸ªç»„ä»¶å†…éƒ¨çš„äº‹ä»¶ç›‘å¬å’Œå¤„ç†å‡½æ•°çš„æ˜ å°„ã€‚å½“ç»„ä»¶æŒ‚è½½æˆ–å¸è½½æ—¶ï¼Œåªæ˜¯åœ¨è¿™ä¸ªç»Ÿä¸€çš„äº‹ä»¶ç›‘å¬å™¨ä¸Šæ’å…¥æˆ–åˆ é™¤ä¸€äº›å¯¹è±¡;å½“äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œé¦–å…ˆè¢«è¿™ä¸ªç»Ÿä¸€çš„äº‹ä»¶ç›‘å¬å™¨å¤„ç†ï¼Œç„¶ååœ¨æ˜ å°„é‡Œæ‰¾åˆ°çœŸæ­£çš„äº‹ä»¶å¤„ç†å‡½æ•°å¹¶è°ƒç”¨ã€‚è¿™æ ·åšç®€åŒ–äº†äº‹ä»¶å¤„ç†å’Œå›æ”¶æœºåˆ¶ï¼Œæå‡äº†é”€é‡ã€‚

### Reactä¸­çš„åˆæˆäº‹ä»¶æ˜¯æ€ä¹ˆå®ç°çš„

#### äº‹ä»¶å§”æ´¾

æŠŠæ‰€æœ‰äº‹ä»¶ç»‘å®šåˆ°ç»“æ„çš„æœ€å¤–å±‚ï¼Œä½¿ç”¨ä¸€ä¸ªç»Ÿä¸€çš„äº‹ä»¶ç›‘å¬å™¨ï¼Œè¿™ä¸ªäº‹ä»¶ç›‘å¬å™¨ä¸Šç»´æŒäº†ä¸€ä¸ªç»„ä»¶å†…éƒ¨çš„äº‹ä»¶ç›‘å¬å’Œå¤„ç†å‡½æ•°çš„æ˜ å°„ã€‚å½“ç»„ä»¶æŒ‚è½½æˆ–å¸è½½æ—¶ï¼Œåªæ˜¯åœ¨è¿™ä¸ªç»Ÿä¸€çš„äº‹ä»¶ç›‘å¬å™¨ä¸Šæ’å…¥æˆ–åˆ é™¤ä¸€äº›å¯¹è±¡;å½“äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œé¦–å…ˆè¢«è¿™ä¸ªç»Ÿä¸€çš„äº‹ä»¶ç›‘å¬å™¨å¤„ç†ï¼Œç„¶ååœ¨æ˜ å°„é‡Œæ‰¾åˆ°çœŸæ­£çš„äº‹ä»¶å¤„ç†å‡½æ•°å¹¶è°ƒç”¨ã€‚

#### è‡ªåŠ¨ç»‘å®š

åœ¨` React `ç»„ä»¶ä¸­ï¼Œæ¯ä¸ªæ–¹æ³•çš„ä¸Šä¸‹æ–‡éƒ½ä¼šæŒ‡å‘è¯¥ç»„ä»¶çš„å®ä¾‹ï¼Œå³è‡ªåŠ¨ç»‘å®š `this` ä¸ºå½“å‰ç»„ä»¶ã€‚ è€Œä¸”` React `è¿˜ä¼šå¯¹è¿™ç§å¼•ç”¨è¿›è¡Œç¼“å­˜ï¼Œä»¥è¾¾åˆ°` CPU` å’Œå†…å­˜çš„æœ€ä¼˜åŒ–ã€‚åœ¨ä½¿ç”¨ `ES6 classes`æˆ–è€…çº¯ å‡½æ•°æ—¶ï¼Œè¿™ç§è‡ªåŠ¨ç»‘å®šå°±ä¸å¤å­˜åœ¨äº†ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨å®ç°` this` çš„ç»‘å®šã€‚

ç»‘å®šæœ‰ä»¥ä¸‹æ–¹æ³•

- æ„é€ å™¨å†…å£°æ˜

```jsx
constructor(props) {
    super(props);
    this.state = {isToggleOn: true};
    // è¿™ä¸ªç»‘å®šæ˜¯å¿…ä¸å¯å°‘çš„ï¼Œå¦åˆ™å›è°ƒå‡½æ•°handleClickä¸­ä¼šè·å–ä¸åˆ°this
    this.handleClick = this.handleClick.bind(this);
}
handleClick(){
  	console.log(this)//åœ¨renderä¸­è°ƒç”¨èƒ½æ­£å¸¸è¾“å‡ºthis
}
```

- create react app é»˜è®¤å¯ç”¨çš„`class fields` è¯­æ³•ï¼ˆğŸ”¥ç°åœ¨ä¸»è¦éƒ½åœ¨ç”¨è¿™ç§æ–¹æ³•ï¼‰

```jsx
class LoggingButton extends React.Component {
  handleClick = () => console.log('this is:', this);
  render() {
    return <button onClick={this.handleClick}>Click me</button>
  }
}
```

- ç®­å¤´å‡½æ•°ï¼Œåˆ©ç”¨çš„æ˜¯ç®­å¤´å‡½æ•°æ€»æ˜¯æŒ‡å‘å‡½æ•°å®šä¹‰çš„æ—¶å€™çš„å¯¹è±¡ï¼Œå› æ­¤ç®­å¤´å‡½æ•°æŒ‡å‘å‡½æ•°å½“å‰çš„å®ä¾‹å¯¹è±¡ã€‚ä¸æ¨èï¼Œå› ä¸ºæ¯æ¬¡æ‰§è¡Œ`render`æ–¹æ³•ï¼Œéƒ½ä¼šåˆ›å»ºæ–°çš„å›è°ƒå‡½æ•°ï¼Œå¯¼è‡´æµ…æ¯”è¾ƒç»“æœä¸åŒï¼Œæ¯æ¬¡éƒ½ä¼šé‡æ–°æ¸²æŸ“ã€‚

```jsx
class LoggingButton extends React.Component {
  handleClick() {
    console.log('this is:', this);
  }
  render() {
    return <button onClick={(e) => this.handleClick(e)}>Click me</button>
  }
}
```

### å’ŒhtmlåŸç”Ÿäº‹ä»¶çš„åŒºåˆ«

```jsx
<button onClick={this.handleClick}>Test</button>
<button onclick="handleClick()">Test</button>
```

è§‚å¯Ÿä»¥ä¸Šä¸¤è¡Œä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°reactåˆæˆäº‹ä»¶å’ŒhtmlåŸç”Ÿäº‹ä»¶çš„åŒºåˆ«ã€‚

|              | reactåˆæˆäº‹ä»¶                               | htmlåŸç”Ÿäº‹ä»¶                         |
| ------------ | ------------------------------------------- | ------------------------------------ |
| äº‹ä»¶å‘½å     | å°é©¼å³°å¼ï¼ˆcamelCaseï¼‰å‘½åï¼ŒğŸŒ°onClick         | å…¨å°å†™å‘½åï¼ŒğŸŒ°onclick                 |
| äº‹ä»¶å±æ€§ç±»å‹ | ä»»æ„ç±»å‹ï¼Œå¯ä»¥æ˜¯å‡½æ•°æŒ‡é’ˆï¼ŒğŸŒ°this.handleClick | jsåŸç”Ÿå­—ç¬¦ä¸²ï¼ŒğŸŒ°"handleClick()"       |
| äº‹ä»¶ç»‘å®šå¯¹è±¡ | æŠŠæ‰€æœ‰çš„äº‹ä»¶ç»‘å®šåœ¨æœ€å¤–å±‚çš„åˆæˆäº‹ä»¶å±‚        | å°†äº‹ä»¶å¤„ç†å™¨ç›´æ¥ç»‘å®šåˆ° HTML å…ƒç´ ä¹‹ä¸Š |

#### é˜»æ­¢é»˜è®¤äº‹ä»¶

æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªğŸŒ°

è€ƒè™‘ä¸‹é¢çš„ç¤ºä¾‹ä»£ç å¹¶æ€è€ƒ**ç‚¹å‡»æŒ‰é’®å**çš„è¾“å‡ºã€‚

```jsx
import React, { useEffect } from "react";
import ReactDOM from "react-dom";
window.addEventListener("click", event => {
	console.log("window");
});


document.addEventListener("click", event => {
	console.log("document:bedore react mount");
});


document.body.addEventListener("click", event => {
	console.log("body");
});


function App() {
  function documentHandler() {
  	console.log("document within react");
  }


  useEffect(() => {
    document.addEventListener("click", documentHandler);
      return () => {
      document.removeEventListener("click", documentHandler);
      };
  }, []);


  return (
  <div
    onClick={() => {
    console.log("react:container");
  }}
  >
    <button
    onClick={event => {
    console.log("react:button");
    }}
    >
      CLICK ME
    </button>
  </div>
);
}

ReactDOM.render(<App />, document.getElementById("root"));

document.addEventListener("click", event => {
	console.log("document:after react mount");
});
export default App;
```

ç­”æ¡ˆä¸º

```javascript
body
document:bedore react mount
react:button
react:container
document within react
document:after react mount
```

è§£æ

- ç‚¹å‡»æŒ‰é’®åï¼Œç”±äºåˆæˆäº‹ä»¶äº‹ä»¶ç»Ÿä¸€ç»‘å®šåœ¨documentçš„äº‹ä»¶å¤„ç†å™¨ä¸Šï¼Œæ‰€ä»¥äº‹ä»¶ä¼šå†’æ³¡åˆ°bodyï¼Œè¾“å‡º"body"
- æ¥ç€äº‹ä»¶å†’æ³¡åˆ°documentï¼Œdocumentä¸Šæœ‰ä¸‰ä¸ªå¤„ç†å™¨ã€‚åˆ†åˆ«æ˜¯åœ¨`render`å‰ç»‘å®šçš„ï¼Œ`render`ä¸­ç»‘å®šçš„`react`ç”¨æ¥ä»£ç†äº‹ä»¶çš„å¤„ç†å™¨å’Œåœ¨`render`åç»‘å®šçš„äº‹ä»¶å¤„ç†å™¨ã€‚
  - åŒä¸€å…ƒç´ ä¸Šå¦‚æœå¯¹åŒä¸€ç±»å‹çš„äº‹ä»¶ç»‘å®šäº†å¤šä¸ªå¤„ç†å™¨ï¼Œä¼šæŒ‰ç…§ç»‘å®šçš„é¡ºåºæ¥æ‰§è¡Œã€‚
  - æ‰€ä»¥ `ReactDOM.render` ä¹‹å‰çš„é‚£ä¸ªå¤„ç†å™¨å…ˆæ‰§è¡Œï¼Œè¾“å‡º `document:before react mount`ã€‚
  - ç„¶åæ˜¯ `React` çš„äº‹ä»¶å¤„ç†å™¨ã€‚æ­¤æ—¶ï¼Œæµç¨‹æ‰çœŸæ­£è¿›å…¥` React`ï¼Œèµ°è¿›æˆ‘ä»¬çš„ç»„ä»¶ã€‚ç»„ä»¶é‡Œé¢å°±å¥½ç†è§£äº†ï¼Œä» `button `å†’æ³¡åˆ° `container`ï¼Œä¾æ¬¡è¾“å‡ºã€‚
  - æœ€å `ReactDOM.render` ä¹‹åçš„é‚£ä¸ªå¤„ç†å™¨å…ˆæ‰§è¡Œï¼Œè¾“å‡º `document:after react mount`ã€‚
- äº‹ä»¶å®Œæˆäº†åœ¨ document ä¸Šçš„å†’æ³¡ï¼Œå¾€ä¸Šåˆ°äº† windowï¼Œæ‰§è¡Œç›¸åº”çš„å¤„ç†å™¨å¹¶è¾“å‡º `window`ã€‚

ç°åœ¨å¯¹ä»£ç åšä¸€äº›å˜åŠ¨ï¼Œåœ¨ body çš„äº‹ä»¶å¤„ç†å™¨ä¸­æŠŠå†’æ³¡é˜»æ­¢ï¼Œå†æ€è€ƒå…¶è¾“å‡ºã€‚

```jsx
document.body.addEventListener("click", event => {
  event.stopPropagation();
  console.log("body");
});
```

ç­”æ¡ˆ

```
body
```

å¦‚æœä½ çœ‹æ‡‚ä¸Šé¢çš„ä»£ç å°±å¯ä»¥çŸ¥é“ï¼Œ**bodyä¸Šçš„é˜²æ­¢å†’æ³¡è®©äº‹ä»¶æ— æ³•å†’æ³¡åˆ°`document`ä¸Šï¼Œæ‰€ä»¥ç»‘å®šåœ¨`document`ä¸Šçš„`react`åˆæˆäº‹ä»¶ä¸€ä¸ªéƒ½ä¸ä¼šæ‰§è¡Œ**ã€‚

#### å‘äº‹ä»¶å¤„ç†ç¨‹åºä¼ é€’å‚æ•°çš„ä¸¤ç§æ–¹å¼

- é€šè¿‡ç®­å¤´å‡½æ•°çš„æ–¹å¼ï¼Œäº‹ä»¶å¯¹è±¡**å¿…é¡»æ˜¾å¼çš„è¿›è¡Œä¼ é€’**
- è€Œé€šè¿‡ `bind` çš„æ–¹å¼ï¼Œäº‹ä»¶å¯¹è±¡ä»¥åŠæ›´å¤šçš„å‚æ•°å°†ä¼šè¢«éšå¼çš„è¿›è¡Œä¼ é€’ã€‚å³eè™½ç„¶æ²¡æœ‰å†™å‡ºæ¥ï¼Œä½†æ˜¯åœ¨æœ€åéšå¼çš„ä¼ é€’äº†ã€‚

```jsx
render(){
  return (
    <div>
      <button onClick={(e) => this.deleteRow(id, e)}>Delete Row</button>
			<button onClick={this.deleteRow.bind(this, id)}>Delete Row</button>
    </div>
  )
}


deleteRow(id,e) {
  //console.log(id,e)
}
```

### æ–‡ç« å‚è€ƒ

[React ä¸­é˜»æ­¢äº‹ä»¶å†’æ³¡çš„é—®é¢˜](https://www.cnblogs.com/Wayou/p/react_event_issue.html)

