### 调用`setState`之后发生了什么

`React`会将传入的参数对象与组件当前的状态合并。

具体的就是：

`setState`会调用`updater`对象身上的`enqueueSetState`方法，让`update`入队。

`update`队列在`fiber`中存储，`fiber`是`ReactElement`上面的一个属性，和`ReactElement`是一一对应的关系。

在`React 15`版本中，组件更新需要递归遍历整个虚拟`DOM`树判断差异，这种递归无法中断，如果需要更新庞大组件，更新过程中可能会长时间阻塞主线程。从而造成用户的交互不能及时响应。`fiber`带来了增量更新功能，将更新任务拆分成更小的任务，并且根据这些任务进行渲染。

具体如下：

- `react`会从目标`fiber`一直往上寻找`rootFiber`对象，并且遍历更新子节点的`expirationTime`，如果子节点的镜像存在，也会更新镜像的`expirationTime`。

- 接着会根据过期时间（比较`FiberRoot`上的`callback`的过期时间，和当前`Task`的过期时间，判断是否是高优先级任务，如果是的话，就打断当前正在执行的任务。

- 接着会判断当前的任务是同步任务还是异步任务。
  - 如果是同步任务的话，就会判断同步队列是否存在，如果同步队列不存在，就会创建同步队列，在下次调度的开始，直接刷新同步队列，如果同步队列存在，那么就将同步任务入队，此时不需要进行调度，因为在创建队列的时候已经进行调度了。
  - 如果是异步任务，则直接把任务用渲染函数进行包装处理并且赋值给`root.CallbackNode`。

