### 什么是Fiber

Fiber 是 React 16 中引入的一种新的内部算法，用于优化和改进 React 应用程序的渲染性能。

在 React 中，每个组件都有一个对应的 Fiber 节点。Fiber 节点存储了组件的状态、属性、类型以及对应的 DOM 节点等信息。Fiber 架构允许 React 在渲染组件时将任务分解为更小的单元，并在浏览器的主线程空闲时才去执行这些任务。这种方式可以避免长时间占用主线程，从而提高应用程序的响应性和性能。

Fiber 还引入了一些新的 React 特性，例如时间分片和并发模式。

#### 时间分片

##### 是什么

时间分片可以让 React 在渲染期间暂停和继续工作，以避免阻塞 UI 更新。

##### 原理

时间分片是一种调度机制，它不是依赖于传统的线程管理，而是基于浏览器提供的 requestIdleCallback API。该API允许开发者在浏览器的空闲时段执行低优先级的任务，而不影响高优先级的任务，如动画和输入响应。

React 使用这个API来实现时间分片。当React开始渲染更新时，它将工作分解成多个小任务。每个任务都有自己的截止时间（deadline），React会在浏览器空闲时处理这些小任务，如果在截止时间之前任务还没有完成，React会将控制权交还给浏览器，以便浏览器可以处理更高优先级的工作（如用户输入响应），然后在浏览器再次空闲时，React会继续之前的工作。

这种机制允许React可以在渲染组件时“暂停”工作，然后在浏览器有空闲时间时“继续”工作，这样就不会阻塞主线程，从而提高应用程序的响应性和性能。

requestIdleCallback API允许开发者指定一个回调函数，在浏览器的空闲周期调用。React 实现时间分片的方式是通过在空闲周期内，分批次执行渲染更新任务，从而实现对任务的管理和调度。如果浏览器不支持 requestIdleCallback，React 会回退到使用 setTimeout 来模拟相同的行为。

#### 并发模式

并发模式允许 React 在后台执行多个任务，以实现对用户操作的更快响应。

总之，Fiber 是 React 的一种新算法，旨在通过对任务的分解和优先级调度，提高应用程序的性能和响应性。它为 React 带来了更好的渲染策略和新的开发特性。
