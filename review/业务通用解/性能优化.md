### 性能监控

使用前端监控工具进行性能分析，定位可能存在的性能问题，持续改进。

#### 衡量指标

##### 加载时间

- 页面栈创建页面耗时
- 首次可交互时间
- 首个有宽高的元素绘制时间
- 页面可交互耗时
- 关键ui绘制完成耗时
- 页面首次交互耗时
- 页面大内容绘制完成耗时

#### 什么时候接入性能监控

提测前，同一个版本接入。由云控控制开关，进行对比。

### 方案：

#### preFetch

是框架级别的优化方案，需要和架构组的同学协同合作。

- 先在prefetch文件和页面ready回调加入时间打点，计算时间差，如果时间差大于300ms，说明页面创建需要这么多时间，就可以在prefetch文件进行请求接入。
- 框架会在编译的时候识别prefetch文件，prefetch会识别出页面中需要发起的请求，在首次请求时对请求进行劫持，另外启动一个线程发起请求。
- 在页面中识别可以进行prefetch的请求时，可以和服务进行勾兑，修改参数，保证请求没有依赖，可以传行进行。
- 业务方需要接入性能平台的埋点，这些埋点在线上包会进行上报。根据性能平台的参数，同版本比较，得到接入prefetch之后性能提升的指标。

优化发方案

1. 减少 HTTP 请求次数：合并文件、雪碧图(Sprite)、内联图片（data URIs）可以减少服务器请求次数。
2. 使用内容分发网络 (CDN)：通过CDN提供静态资源（CSS文件、JavaScript文件、图片等），可以降低服务器负载并缩短资源加载时间。
3. 压缩资源：使用工具压缩CSS、JS文件和图片，减少文件大小，快速加载页面。
4. 优化图片：确保图片的尺寸不大于它们在页面上显示的大小，并使用正确的图片格式。使用WebP、JPEG 2000、JPEG XR等现代图片格式。
5. 缓存利用：通过设置HTTP缓存头信息，让浏览器缓存已下载的静态资源。
6. CSS和JavaScript的加载优化：
   * 使用非阻塞JavaScript的方式（async和defer属性）
   * 确保CSS加载对渲染的阻塞最小
   * 使用CSS媒体查询加载对应设备的样式表。
7. DOM操作优化：尽量减少DOM操作，使用DocumentFragment或者批量操作来提升性能。
8. 使用前端构建工具：使用如Webpack、Gulp等构建工具来优化资源的构建和加载。
9. 减少重排(repaints)和重绘(reflows)：优化JavaScript和CSS以减少浏览器的重排和重绘动作。
10. 懒加载(Lazy Load)：对于不是立即需要展示的资源（如图片、视频等），可以通过懒加载推迟它们的加载时机，从而加快页面初始显示速度。
11. 避免使用大量框架和库：过度依赖前端框架和库会增加页面的加载时间。
12. 检查和优化第三方插件：第三方插件可能会严重拖慢前端性能，定期检查它们的性能并进行替换或干脆删除。
13. 使用Web Workers：对于复杂的数据处理，可以使用Web Workers在后台线程中运行，避免阻塞UI。
14. 移动设备优化：针对移动设备做适配并优化，比如使用响应式设计、触摸事件优化等。
