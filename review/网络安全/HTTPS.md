`https`是 `http`+`ssl`或者 `http`+`tls`。

`http`用的是明文传输，这样它传输的数据就十分的不安全，所以需要对传输的数据进行加密。

加密存在以下方案

- 对称加密：效率高，但是如果共享密钥被窃取，那么加密就会失去意义。
- 非对称加密：算法复杂，效率低，但是很安全。

因此，HTTPS采用了对称加密+非对称加密的方式：

* 使用非对称加密传输密钥，防止密钥被窃取。
* 使用对称加密加密数据，确保传输效率和安全。

可是如何保证服务器的公钥没有被攻击者替换掉呢？

* 可以使用CA机构颁发的数字证书。

### 具体过程

1. **浏览器发送请求** ：浏览器发送支持的加密规则（加密套件）给服务器。
2. **服务器响应** ：服务器从中选取一种加密规则，并发送给浏览器。
3. **证书颁发** ：
   1. 服务器向CA机构申请数字证书。CA证书包含服务器公钥、签发者信息、证书用途、证书到期时间、使用的HASH算法、签名算法等。
   2. CA机构对证书内容求一个HASH值，然后用CA私钥对HASH值和使用的HASH算法进行加密，生成数字签名。服务器将包含数字签名的CA证书发送给浏览器。

### 数字签名的作用

* CA机构不直接加密证书，而是对证书内容的HASH值及其HASH算法进行加密，这是因为非对称加密算法效率低，而HASH值的大小是固定的，更加高效。
* 数字签名的作用不是防止证书内容被窃取，而是防止证书内容被篡改。

4. **客户端验证证书** ：

* 校验证书中的域名是否与正在访问的网站一致，证书是否过期。
* 将证书颁发者与操作系统内置的CA进行比对，验证证书的合法性。
* 客户端用CA公钥解密数字签名，取出HASH值和HASH算法。使用相同的HASH算法对证书内容计算HASH值，比较计算得到的HASH值与解密得到的HASH值是否一致。如果一致，证书被认为是有效的，客户端提取服务器的公钥。

5. **生成共享密钥** ：

* 客户端生成共享密钥，用服务器的公钥加密后发送给服务器。
* 服务器用私钥解密共享密钥。

6. **安全通信** ：

* 服务器和浏览器使用共享密钥进行对称加密通信。
* 如果在握手过程中出现任何错误，加密连接会断开。
