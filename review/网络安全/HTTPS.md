`https`是 `http`+`ssl`或者 `http`+`tls`。

`http`用的是明文传输，这样它传输的数据就十分的不安全，所以需要对传输的数据进行加密。

加密存在以下方案

- 对称加密：效率高，但是如果共享密钥被窃取，那么加密就会失去意义。
- 非对称加密：
  - 公钥加密，私钥解密，主要负责传输数据
  - 私钥加密，公钥解密。主要负责做数字签名
  - 算法复杂，效率低，但是很安全。

因此，HTTPS采用了对称加密+非对称加密的方式：

* 使用非对称加密传输密钥，防止密钥被窃取。
* 使用对称加密加密数据，确保传输效率和安全。

可是如何**保证服务器的公钥没有被攻击者替换掉**呢？

* 可以使用CA机构颁发的数字证书。

### HTTPS中的CA认证过程

#### CA机构的角色

**可信第三方** :

* CA机构是一个被广泛认可的第三方机构。
* CA机构的主要任务是确认服务器的身份，并为服务器颁发数字证书。

**数字证书** :

* 数字证书是一个电子文档，其中包含了服务器的身份信息（如域名、组织名称等）和公钥。
* 数字证书还包含了CA机构的数字签名，以证明证书的有效性。

#### 证书申请过程

1. **浏览器发送请求** ：浏览器发送支持的加密规则（加密套件）给服务器。
2. **服务器响应** ：服务器从中选取一种加密规则，并发送给浏览器。
3. **证书请求** :

* 服务器管理员向CA机构提交一份证书签名请求
* CA机构会对服务器的身份进行验证，确保请求者是合法的所有者。
* 这个过程可能包括域名所有权验证、组织身份验证等步骤。

4. **证书颁发** :

* 一旦验证完成，CA机构会为服务器颁发数字证书。
* CA证书包含服务器公钥、签发者信息、证书用途、证书到期时间、使用的HASH算法、签名算法等。
* CA机构对证书内容求一个HASH值，然后用CA私钥对HASH值和使用的HASH算法进行加密，生成数字签名。服务器将包含数字签名的CA证书发送给浏览器。

5. **证书安装** :

* 服务器管理员将颁发的数字证书安装在服务器上。

#### 客户端连接过程

1. **证书交换** :

* 当客户端尝试连接到服务器时，服务器会向客户端发送自己的数字证书。

2. **证书验证** :

* 客户端会检查证书的有效性：

  * 检查证书是否过期。
  * 检查证书是否被吊销。
  * 检查证书是否由受信任的CA机构签发。
  * 检查证书中的域名是否与访问的域名匹配。
  * 客户端用CA公钥解密数字签名，取出HASH值和HASH算法。使用相同的HASH算法对证书内容计算HASH值，比较计算得到的HASH值与解密得到的HASH值是否一致。如果一致，证书被认为是有效的。

**数字签名的作用**

* CA机构不直接加密证书，而是对证书内容的HASH值及其HASH算法进行加密，这是因为非对称加密算法效率低，而HASH值的大小是固定的，更加高效。
* 数字签名的作用不是防止证书内容被窃取，而是防止证书内容被篡改。

3. **建立安全连接** :

* 如果证书有效，客户端会使用证书中的公钥加密一个随机生成的对称密钥，并发送给服务器。
* 服务器使用私钥解密并获取对称密钥。
* 之后的通信使用这个对称密钥进行加密和解密，以提高效率。
