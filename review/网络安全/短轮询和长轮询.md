# 短轮询和长轮询

[HTTP协议中的短轮询、长轮询、长连接和短连接](https://www.cnblogs.com/knowledgesea/p/6813832.html)
[添加链接描述](https://www.cnblogs.com/BluceLee/p/9042747.html)

- 短轮询

> 轮询是在特定的的时间间隔（如每1秒），由浏览器对服务器发出HTTP request，然后由服务器返回最新的数据给客户端的浏览器。这种传统的HTTP request 的模式带来很明显的缺点 – 浏览器需要不断的向服务器发出请求，然而HTTP request 的header是非常长的，里面包含的有用数据可能只是一个很小的值，这样会占用很多的带宽。

```
var xhr = new XMLHttpRequest();
setInterval(function(){
    xhr.open('GET','/user');
    xhr.onreadystatechange = function(){

    };
    xhr.send();
},1000)
```

- 长轮询
  ajax实现:在发送ajax后,服务器端会**阻塞请求直到有数据传递或超时**才返回。 客户端JavaScript响应处理函数会在处理完服务器返回的信息后，再次发出请求，重新建立连接。服务器最好

## 轮询可能在以下3种情况时终止。

- 有新数据推送 。当服务器向浏览器推送信息后，应该主动结束程序运行从而让连接断开，这样浏览器才能及时收到数据。
- 没有新数据推送 。应该设定一个最长时限，避免WEB服务器超时（Timeout），若一直没有新信息，服务器应主动向浏览器发送本次轮询无新信息的正常响应，并断开连接，这也被称为“心跳”信息。
- 网络故障或异常 。由于网络故障等因素造成的请求超时或出错也可能导致轮询的意外中断，此时浏览器将收到错误信息。

## 长连接优势和缺陷

优点：在无消息的情况下不会频繁的请求，耗费资源小。
缺点：服务器hold住连接会消耗资源，**返回数据顺序无保证**，难于管理维护。
实例：WebQQ、Hi网页版、Facebook IM。