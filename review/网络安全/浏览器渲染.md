### 关键渲染路径

指浏览器接收到服务器返回的`HTML`、`CSS`和`JavaScript`字节数据并对其进行解析和转变成像素的渲染过程

通过优化关键渲染路径即可以缩短浏览器渲染页面的时间。

### 浏览器渲染页面的过程

- 处理 `HTML` 标记并构建 `DOM` 树
- 处理 `CSS` 标记并构建 `CSSOM` 树
- 将 `DOM` 与 `CSSOM` 合并成一个渲染树
- 根据渲染树来布局，以计算每个节点的位置大小信息
- 将各个节点绘制到屏幕上

### 阻塞渲染：`CSS` 与 `JavaScript`

现代浏览器总是**并行加载资源**。当文档加载过程中遇到`JS`文件，HTML解析器虽然会停止构建 `DOM`，但仍会识别该脚本后面的资源，并进行**预加载**。直到文档中`JS`文件加载、解析、执行完毕，才会继续`HTML`的渲染过程。`CSS`文件的加载不影响`JS`文件的加载，但是却影响`JS`文件的执行。`JS`代码执行前浏览器必须保证`CSS`文件已经下载并加载完毕。

所以，`script` 标签的位置很重要。实际使用时，可以遵循下面两个原则：

1. `CSS` 优先：引入顺序上，`CSS` 资源先于 `JavaScript` 资源。
2. `JavaScript` 应尽量少影响 `DOM` 的构建。

## **`CSS`**

渲染树的关键渲染路径中，要求同时具有 `DOM` 和 `CSSOM`，之后才会构建渲染树。即，`HTML` 和 `CSS` 会阻塞渲染。`HTML` 显然是必需的，因为包括我们希望显示的文本在内的内容，都在` DOM` 中存放，那么可以从 `CSS` 上想办法。

- **精简 `CSS` 并尽快提供它**
- 媒体类型（media type）和媒体查询（media query）来解除对渲染的阻塞

```html
<link href="index.css" rel="stylesheet">
<link href="print.css" rel="stylesheet" media="print">
<link href="other.css" rel="stylesheet" media="(min-width: 30em) and (orientation: landscape)">
```

## **`JavaScript`**

**`defer` 与 `async`**

🌟注意： `async` 与 `defer` 属性对于 `inline-script` 都是无效的，只对设置了 `src` 属性的 script 标签有效。

`defer` 属性表示**立即下载，延迟执行**。引入的 `JavaScript` 会延迟到页面解析完毕再执行。脚本按照它们出现的先后顺序执行。

`async`属性表示**立即下载，加载完毕执行**，脚本并不保证按照指定它们的先后顺序执行。