[DNS原理入门-阮一峰](<http://www.ruanyifeng.com/blog/2016/06/dns.html>)

### DNS（D**omain **N**ame **System）是什么

**域名系统**，将方便用户记忆的域名地址转换为数字串[IP](https://developer.mozilla.org/en-US/docs/Glossary/IP_address)，从而在因特网[Internet](https://developer.mozilla.org/en-US/docs/Glossary/Internet) 或者私有网络上找到特定的机器。它作为将[域名](https://zh.wikipedia.org/wiki/域名)和[IP地址](https://zh.wikipedia.org/wiki/IP地址)相互[映射](https://zh.wikipedia.org/wiki/映射)的一个[分布式数据库](https://zh.wikipedia.org/wiki/分布式数据库)。

### DNS的常见用法

将服务器名称和 IP 地址进行关联，将邮件地址和邮件服务器进行关联,以及为各种信息关联相应的名称。

### 为什么要转换成IP地址

TCP/IP 网络是通过 IP 地址来确定通信对象的，不知道 IP 地址就无法将消息发送给对方，因此，在委托操作系统发送消息时，必须要先查询好对方 的 IP 地址。

### 域名和 IP 地址并用的理由

- 不用IP 地址，而是用域名来确定通信对象?
  IP 地址的长度 为 32 比特（ 4 字节），使用域名最少也要几十个字节，最长可达到255字节，**增加了路由器的负担**,传送数据也会花费更长的时间 ，运行效率较低。（路由转发包传输数据）
- 浏览器网址中不写服务器的名字，直接写IP 地址?
  用IP地址来代替服务器名称也是能够正常工作的 。然而，要**记住 IP 地址非常困难**
- 让人来使用名称,让路由器来使用IP地址。
  为了填补两者之间的障碍,需要有一个机制能够通过名称来查询IP地址,或者通过IP 地址来查询名称,这个机制就是DNS

### 域名的层级

 DNS服务器怎么会知道每个域名的IP地址呢？答案是分级查询。

举例来说，`www.example.com`真正的域名是`www.example.com.root`，简写为`www.example.com.`。因为，根域名`.root`对于所有域名都是一样的，所以平时是省略的。

根域名的下一级，叫做"顶级域名"·，比如`.com`、`.net`；再下一级叫做"次级域名"（second-level domain，缩写为SLD），比如`www.example.com`里面的`.example`，这一级域名是用户可以注册的；再下一级是主机名（host），比如`www.example.com`里面的`www`，又称为"三级域名"，这是用户在自己的域里面为服务器分配的名称，是用户可以任意分配的。

总结一下，域名的层级结构如下。

> ```bash
> 主机名.次级域名.顶级域名.根域名
> # 即
> host.sld.tld.root
> ```

### DNS解析（递归解析和迭代解析）

- **浏览器**根据地址去本身缓存中查找dns解析记录，如果有，则直接返回IP地址，否则，浏览器会在操作系统缓存中（包括本机的 hosts文件）查找有没有对应的域名映射。

- 如果浏览器缓存和操作系统中均无该域名的dns解析记录，或者已经过期，**操作系统**将域名发送至 本地 DNS服务器，让本地域名服务器尝试解析

- 如果**本地 DNS 服务器**没有缓存不能直接将域名转换为 IP 地址，需要采用递归或者迭代查询的方式依次向**根域名服务器**、**顶级域名服务器**、**权威域名服务器**发起查询请求，如下图所示：

  ![img](https://pic1.zhimg.com/80/v2-b6cf454b2fc9144470f097c827a13ab0_hd.jpg)

![img](https://github.com/glbb666/myNote/blob/master/review/网络安全/image/dns.jpg)

#### 递归解析

  ##### 简介：

  局部DNS服务器一层层的向其他DNS服务器进行查询，直到得到查询结果为止。

  ##### 过程：

  本地域名服务器 向 该域名的根域名服务器查询

  根域名服务器 向 该域名的顶级域名服务器查询

  顶级域名服务器 向 该域名的次级域名服务器查询

  次级域名服务器把 查询结果 发给  该域名的顶级域名服务器

  顶级域名服务器把 查询结果 发给  该域名的根域名服务器

  根域名服务器把 查询结果 发给 本地域名服务器

#### 迭代解析

  ##### 简介：

  局部DNS服务器把能解析该域名的其他DNS服务器的IP地址返回给本地域名服务器，本地域名服务器再继续向这些DNS服务器进行查询，直到得到查询结果为止。

  ##### 过程：

  本地域名服务器 向 该域名的根域名服务器查询，根域名服务器把顶级域名服务器的IP发给本地域名服务器

  本地域名服务器 向 该域名的顶级域名服务器查询，顶级域名服务器把次级域名服务器的IP发给本地域名服务器

  本地域名服务器 向 该域名的次级域名服务器查询，次级域名服务器把查询结果发给本地域服务器

💥注意：次级域名服务器会查询存储的域名和IP的映射关系表，正常情况下都根据域名得到目标IP记录，连同一个TTL值返回给DNS Server域名服务器

- 本地域名服务器 将得到的<font color='red'> 该域名对应的IP和TTL值</font>返回给操作系统，同时会缓存这个域名和IP的对应关系，缓存的时间有TTL值控制。
- 操作系统将 IP 地址返回给浏览器，同时自己也将 IP 地址根据TTL值缓存在本地系统缓存，以备下次别的用户查询时，可以直接返回结果，加快网络访问。
- 至此，浏览器已经得到了域名对应的 IP 地址。

