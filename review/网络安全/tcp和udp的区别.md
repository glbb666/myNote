### TCP和UDP的区别(2个面向，2个可靠)

（1）`TCP`是面向连接的，`udp`是无连接。（即发送数据前不需要先建立连接）

（2）`TCP`是面向字节流，`UDP`面向报文，并且网络出现拥塞不会使得发送速率降低（因此会出现丢包，对实时的应用比如 `IP`电话和视频会议等）。

（3）`TCP`提供可靠的服务。通过 `TCP`连接传送的数据，无差错，不丢失，不重复，且按序到达;`UDP`不保证可靠交付。

（4）`TCP`的逻辑通信信道是全双工的可靠信道，`UDP`则是不可靠信道

（5）`TCP`只能是一对一的，`UDP`支持一对一，一对多，多对一和多对多的交互通信

（6）`TCP`的首部较大为20字节，而 `UDP`只有8字节。

（7）`TCP`可拆分可合并，`UDP`不可拆分不可合并。

### TCP 协议是如何保证可靠传输的？

1. 校验和：`TCP` 将保持它首部和数据的检验和。目的是防止数据在传输过程中发生变化。如果收到段的检验和有差错，接收方将丢弃这个报文段和不确认收到此报文段。此时没有收到 `ack`的发送端将进行超时重发。
2. 超时重发：当 `TCP` 发出一个段后，它**启动一个定时器**，等待目的端确认收到这个报文段。如果不能及时收到一个确认，将重发这个报文段；
3. 应答机制：当 TCP 收到发自 TCP 连接另一端的数据，它将发送一个确认。这个确认不是立即发送，通常将推迟几分之一秒；
4. 丢弃重复数据：TCP 的接收端会丢弃重复的数据。
5. 失序重排：TCP基于序列号进行失序重排，规则在下面详细说明
6. 停止等待协议：基本原理就是每发完一个分组就停止发送，等待对方确认。在收到确认后再发下一个分组。
7. 流量控制：TCP 连接的每一方都有固定大小的缓冲空间。TCP 的接收端只允许另一端发送接收端缓冲区所能接纳的数据，这可以防止较快主机致使较慢主机的缓冲区溢出。TCP 利用滑动窗口实现流量控制。

   > TCP 利用滑动窗口实现流量控制。流量控制是为了控制发送方发送速率，保证接收方来得及接收。接收方发送的确认报文中的窗口字段可以用来控制发送方窗口大小，从而影响发送方的发送速率。将窗口字段设置为 0，则发送方不能发送数据。
   >

### TCP序列号规则

- 序列号递增（服务端和客户端独自递增）
- SYN，FIN控制位消耗一个序列号，其他控制位不消耗序列号。
- 数据部分一个字节消耗一个序列号。
- 序列号是基于之前的包消耗的序列号进行计算。举个例子，如果上次发送的TCP包的序列号是x，且该包没有携带数据，也不是SYN或FIN包。
  - 那么服务端发送的下一个包（不管是什么包，有没有携带数据）的序列号将会是x
- 接收方对数据包进行排序后再传送给应用层。

### ACK机制

ACK包的ack值是为了告诉接收方，发送方下次期待得到的序列号为ack值
